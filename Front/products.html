<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Danh S√°ch S·∫£n Ph·∫©m - G√≥c Xinh Decor</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script defer src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script defer src="script.js"></script>
    <style>
        body {
            background-color: #f5f5f5;
        }

        .product-item {
            text-align: center;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 10px;
            background: white;
            margin-bottom: 20px;
        }

        .product-item img {
            width: 100%;
            height: auto;
            border-radius: 10px;
        }

        .product-item h5 {
            font-size: 16px;
            margin: 10px 0;
        }

        .product-item .price {
            font-weight: bold;
            color: #007bff;
        }

        .product-item .old-price {
            text-decoration: line-through;
            color: gray;
            font-size: 14px;
        }

        .sidebar {
            background: white;
            padding: 20px;
            border-radius: 10px;
        }
    </style>
</head>

<body>

    <!-- Header -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container">
            <a class="navbar-brand" href="home.html"><img src="img/logo.png" width="50"> <strong>G√≥c Xinh
                    Decor</strong></a>
            <div class="d-flex">
                <input type="text" class="form-control me-2" placeholder="T√¨m ki·∫øm s·∫£n ph·∫©m...">
                <button class="btn btn-outline-secondary">üîç</button>
            </div>
        </div>
    </nav>

    <!-- Thanh ƒëi·ªÅu h∆∞·ªõng -->
    <div class="container mt-3">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="home.html">TRANG CH·ª¶</a></li>
                <li class="breadcrumb-item active" id="categoryName" aria-current="page">Danh M·ª•c</li>
            </ol>
        </nav>
    </div>

    <div class="container mt-4">
        <div class="row">
            <!-- Danh m·ª•c s·∫£n ph·∫©m -->
            <div class="col-md-3 sidebar">
                <h5><strong>DANH M·ª§C S·∫¢N PH·∫®M</strong></h5>
                <ul class="list-unstyled" id="categoryList">
                    <!-- Danh m·ª•c s·∫Ω ƒë∆∞·ª£c t·∫£i t·ª´ API -->
                </ul>

                <h5 class="mt-4"><strong>L·ªåC THEO GI√Å</strong></h5>
                <input type="range" class="form-range" id="priceRange" min="500000" max="5000000">
                <p>Gi√°: <span id="priceLabel">500.000 - 5.000.000ƒë</span></p>
                <button class="btn btn-dark w-100">L·ªåC</button>
            </div>


            <!-- Danh s√°ch s·∫£n ph·∫©m -->
            <div class="col-md-9">
                <h3 id="categoryName">T·∫•t c·∫£ s·∫£n ph·∫©m</h3>
                <p>Hi·ªÉn th·ªã <span id="productCount">0</span> s·∫£n ph·∫©m</p>
                <div class="row" id="product-list"></div>
            </div>
        </div>
    </div>

    <script>
        const BASE_URL = "http://localhost:8080"; // API ch·∫°y tr√™n c·ªïng 8080
        const IMAGE_FOLDER = "img/"; // Th∆∞ m·ª•c ch·ª©a ·∫£nh

        // üìå L·∫•y categoryID t·ª´ URL

        function getCategoryID() {
            const params = new URLSearchParams(window.location.search);
            return params.get("categoryID"); // Tr·∫£ v·ªÅ categoryID ho·∫∑c null n·∫øu kh√¥ng c√≥
        }

        function loadCategories() {
            fetch(`${BASE_URL}/api/category`)
                .then(response => response.json())
                .then(categories => {
                    const categoryList = document.getElementById("categoryList");
                    categoryList.innerHTML = '<li><a href="products.html">T·∫•t c·∫£ s·∫£n ph·∫©m</a></li>'; // Th√™m t√πy ch·ªçn "T·∫•t c·∫£ s·∫£n ph·∫©m"
                    categories.forEach(category => {
                        categoryList.innerHTML += `
                    <li>
                        <a href="products.html?categoryID=${category.categoryID}" class="${category.categoryID == getCategoryID() ? 'fw-bold text-primary' : ''}">
                            ${category.categoryName}
                        </a>
                    </li>`;
                    });

                    // C·∫≠p nh·∫≠t ti√™u ƒë·ªÅ danh m·ª•c
                    const selectedCategory = categories.find(cat => cat.categoryID == getCategoryID());
                    document.getElementById("categoryName").innerText = selectedCategory ? selectedCategory.categoryName : "T·∫•t c·∫£ s·∫£n ph·∫©m";
                })
                .catch(error => console.error("L·ªói t·∫£i danh m·ª•c:", error));
        }

        function loadProducts() {
            const categoryID = getCategoryID();
            const apiUrl = categoryID ? `${BASE_URL}/api/products/category/${categoryID}` : `${BASE_URL}/api/products`;

            fetch(apiUrl)
                .then(response => response.json())
                .then(products => {
                    const productList = document.getElementById("product-list");
                    productList.innerHTML = "";
                    document.getElementById("productCount").innerText = products.length;
                    products.forEach(product => {
                        let oldPrice = product.price + 500000;
                        productList.innerHTML += `
                    <div class="col-md-4">
                        <div class="product-item">
                            <img src="${product.imageURL}" alt="${product.productName}" onerror="this.src='img/default.jpg'">
                            <h5>${product.productName}</h5>
                            <p class="old-price">${oldPrice.toLocaleString()}ƒë</p>
                            <p class="price">${product.price.toLocaleString()}ƒë</p>
                            <button class="btn btn-primary w-100" onclick="addToCart(${product.productID})">MUA NGAY</button>
                            <p><a href="product-detail.html?id=${product.productID}&category=${categoryID || ''}">Xem chi ti·∫øt</a></p>
                        </div>
                    </div>`;
                    });
                })
                .catch(error => console.error("L·ªói t·∫£i s·∫£n ph·∫©m:", error));
        }

        function addToCart(productID) {
            fetch(`${BASE_URL}/api/cart/add`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ userID: 2, productID: productID, quantity: 1 })
            })
                .then(response => response.json())
                .then(data => alert("S·∫£n ph·∫©m ƒë√£ ƒë∆∞·ª£c th√™m v√†o gi·ªè h√†ng!"))
                .catch(error => console.error("L·ªói th√™m v√†o gi·ªè h√†ng:", error));
        }

        document.addEventListener("DOMContentLoaded", function () {
            loadCategories();
            loadProducts();
        });
    </script>

</body>

</html>